% -------------------------------------------------------------------------------------
% Plantilla de un artículo para publicar en la Revista Colombiana de Estadística
% *************************************************************************************
% -------------------------------------------------------------------------------------
% Establecer primero el idioma principal del artículo, por defecto es español; para
% utilizar otro idioma, cambiar el comando "\documentclass{revcoles}" por el comando
% "\documentclass[english]{revcoles}" o por "\documentclass[portuguese]{revcoles}"
% **** --------------------------------------------------------------------------------
\documentclass[report,oneside]{revcoles}
\usepackage[top=2cm,bottom=1cm,left=2cm,right=2cm]{geometry}
\labeldocument[
university = Universidad del Valle,
program = Programa Académico de Estadística,
subject = Estadística Aplicada III,
city = Cali,
month = 9,
year = 2018]

% -------------------------------------------------------------------------------------
% Espacio reservado para la carga de los paquetes por parte del autor
% **** --------------------------------------------------------------------------------




% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Espacio reservado para colocar las definiciones especiales por parte del autor
% **** --------------------------------------------------------------------------------



% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Espacio utilizado para colocar las palabras que necesitan partición silábica
% **** --------------------------------------------------------------------------------
\hyphenation{Colombia mul-ti-va-ria-do pro-ba-bi-li-dad es-ta-dís-ti-ca}
% //// --------------------------------------------------------------------------------
\begin{document}

% -------------------------------------------------------------------------------------
% Espacio reservado para ingresar el título del artículo
% "maintitle = " título original del artículo
% "secondtitle = " título del artículo traducido al idioma alterno
% "shorttitle = " título corto (opcional) para el encabezado
% **** --------------------------------------------------------------------------------
\title[maintitle = {Laboratorio 2: ACP con datos faltantes},
       %secondtitle = Template for report in a course,
       shorttitle = ACP con datos faltantes
]
% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Espacio reservado para ingresar el(los) autor(es) del artículo de forma individual.
% opción "firstname = " nombres completos de cada autor
% opción "surname = " primer apellido de cada autor
% opción "numberinstitution = " número que identifica la institución a la que pertenece
%         el autor, en caso de haber solo una institución el campo se elimina
% opción "affiliation = " afiliación o cargo que desempeña el autor en la institución
% opción "email = " dirección electrónica del autor (preferiblemente institucional)
% **** --------------------------------------------------------------------------------
\begin{authors}
\author[firstname = Kevin Steven,
        surname = García,
        code = Código: 1533173,
        email = kevin.chica@correounivalle.edu.co,
]
\author[firstname = Alejandro,
        surname = Vargas,
        code = Código: 1525953 ,
        email = jose.alejandro.vargas@correounivalle.edu.co
]
\end{authors}
% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Espacio reservado para ingresar la información de la(s) institución(es) a la(s)
% cual(es) pertenece(n) el(los) autor(es)
% Usar un comando "\institute"  por cada una de las diferentes instituciones.
% Los campos "subdivision" y "division" son opcionales
% Los campos "institution", "city" y "country" son obligatorios
% **** --------------------------------------------------------------------------------
\begin{comment}
\begin{institutions}
     \institute[subdivision = Departamento de Estadística,
                division = Facultad de Ciencias,
                institution = Universidad del Valle,
                city = Cali,
                country = Colombia]
\end{institutions}
\end{comment}
% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% CUERPO DEL DOCUMENTO
% **** --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Espacio reservado para colocar el resumen en el idioma principal y las palabras clave
% !!No dejar salto de línea entre el resumen y el comando \keywords{.}¡¡
% **** --------------------------------------------------------------------------------
\begin{comment}
\begin{mainabstract}
Este documento contiene las instrucciones de presentación de los
trabajos de cursos. Este texto está escrito utilizando \LaTeX\
como editor según formato adjunto (archivo \emph{Template for Report.tex})
y puede utilizarse como guía, reemplazando este contenido. Se requieren los
archivos \emph{revcoles.cls}, \emph{references.bib} y \emph{graph\_example.eps}.%
%
\keywords{Formato en \LaTeX\ para documentos, carrera de Estadística}
\end{mainabstract}
\end{comment}
% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Espacio reservado para colocar el resumen en el idioma secundario y las palabras clave
% !!No dejar salto de línea entre el resumen y el comando \keywords{.}¡¡
% **** --------------------------------------------------------------------------------
\begin{comment}
\begin{secondaryabstract}
This document gives the instructions to prepare a \LaTeX\ version of the graduation project of undergraduate in
Statistics to first semester of 2008. The document is written using a \LaTeX\ format (file \emph{Plantilla para trabajo
de grado.tex}) and can be used as a guideline just replacing its contents. It is necessary to use also the files
\emph{revcoles.cls}, \emph{references.bib} and \emph{graph\_example.eps}.
%
\keywords{\LaTeX\ format for documents, undergraduate in Statistics}
\end{secondaryabstract}

\end{comment}% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Título de la primera sección
% **** --------------------------------------------------------------------------------
\section{Introducción}
~\\En el presente informe veremos la aplicación del ACP con datos completos y datos faltantes a la matriz de datos correspondientes a las importaciones de los países sudamericanos provenientes de estados unidos entre 1991 y 2010. El ACP con datos faltantes se realizará a la matriz de datos mencionada con el 5,10,15, y 20\% de datos faltantes, por medio de dos algoritmos, el algoritmo NIPALS y el ACP-EM, se mostraran los resultados obtenidos y se comparará la eficiencia o la imputación obtenida de los dos algoritmos en cuanto a las estimaciones de los datos faltantes con respecto a la matriz de datos original. Además se analizará el comportamiento de los métodos en cuanto a valores y vectores propios obtenidos, porcentaje de Inercia explicado por los ejes, la estructura factorial en la nube de individuos y en la nube de variables, la ortogonalidad en las componentes y la ortonormalidad de los vectores propios obtenidos.

~\\ La base de datos sobre la cuál se va a trabajar es la siguiente:
\begin{center}
\begin{tabular}{|ccccccc|}
\hline
Año	& Colombia & Brasil & Chile & Argentina &	Ecuador &	Peru \\
\hline
1991 &	44.4	&27.2&	45.6&	20.0&	6.0	&14.1\\
1992 &	75.5&	11.8&	58.9&	22.6&	17.8&	14.4\\
1993 &	110.7&	50.6&	128.3&	17.2&	119.4&	118.5\\
1994 &	80.3&	70.6&	102.2&	15.2&	154.9&	146.1\\
1995 &	81.6&	82.3&	89.0&	35.1&	169.4&	127.1\\
1996 &	76.4&	97.4&	185.0&	51.0&	75.5&	129.0\\
1997 &	32.0&	89.5&	195.3&	31.1&	33.4&	110.2\\
1998 &	55.5&	63.1&	66.3&	24.4&	9.7	&     66.7\\
1999 &	74.3&	72.6&	76.3&	28.1&	11.2&	110.7\\
2000 &	84.5&	76.2&	80.1&	29.5&	11.8&	110.2\\
2001 &	87.1&	97.4&	89.3&	51.5&	63.1&	89.3\\
2002 &	89.3&	89.5&	72.4&	40.3&	66.3&	70.2\\
2003 &	70.2&	63.1&	80.1&	60.5&	76.3&	90.1\\
2004 &	90.1&	66.3&	70.5&	39.1&	20.0&	64.5\\
2005 &	60.5&	76.3&	107.2&	31.1&	63.4&	92.7\\
2006 &	140.3&	20.0&	63.4&	50.2&	101.2&	120.8\\
2007 &	120.4&	22.6&	101.2&	51.0&	103.1&	107.2\\
2008 &	130.2&	17.2&	103.1&	42.5&	66.7	&70.8\\
2009 &	110.1&	31.1&	75.6&	25.7&	110.7	&101.2\\
2010 &	120.2&	24.4&	68.9&	60.3&	110.2	&110.8\\
\hline
\end{tabular}
\end{center}

\pagebreak
\section{ACP datos completos}
~\\En el laboratorio 1 se vio paso por paso la aplicación del ACP, por lo tanto se mostraran solo los resultados obtenidos,es decir, los valores y vectores propios u, y las componentes principales Z$\cdot$ u.

~\\Los valores y vectores propios obtenidos para la matriz de correlaciones asociada a la matriz de datos completa son:
\begin{center}
\begin{tabular}{|cccccc|}
\hline 
$\lambda_{1}$ & $\lambda_{2}$ & $\lambda_{3}$ & $\lambda_{4}$ & $\lambda_{5}$ & $\lambda_{6}$ \\ 
2.1934092  & 1.9561781 &0.9038789 &0.5119470 &0.2854407 &0.1491461 \\ 
\hline 
\end{tabular} 
\end{center}
\begin{center}
\begin{tabular}{|cccccc|}
\hline 
$\lambda_{1}$ & $\lambda_{2}$ & $\lambda_{3}$ & $\lambda_{4}$ & $\lambda_{5}$ & $\lambda_{6}$ \\ 
-0.3266572 & 0.5708984 & 0.0068014 & 0.1170875 & 0.5332445 & 0.5189071 \\ 
-0.1588587 & -0.6033277 & 0.2009878 & -0.5413708 & 0.1852719 & 0.4929051 \\ 
-0.3381710 & -0.4635960 & 0.0514265 & 0.7890499 & -0.0779079 & 0.1985066 \\ 
-0.2898593 & 0.2066273 & 0.8863988 & -0.0448699 & -0.2455986 & -0.1589085 \\ 
-0.5459391 & 0.1756044 & -0.3785943 & -0.2216216 & -0.6626128 & 0.1990175 \\ 
-0.6096157 & -0.1470297 & -0.1669623 & -0.1395665 & 0.4193810 & -0.6192861 \\ 
\hline 
\end{tabular} 
\end{center}

~\\Entonces, las componentes serán:

\[C=
\left(
\begin{array}{cccccc}
3.57940293 & 0.2200186 & -0.45449358 & 0.07133223 & -0.720973151 & -0.20047529 \\
2.98416620 & 1.1042398 & -0.46390509 & 0.71180698 & -0.455553845 & 0.19923050 \\
-1.18011107 & -0.0116174& -1.74610834&  0.70549306&  0.310200546&  0.48646527 \\
-1.55340630& -0.7593625& -2.19242499& -0.62366337& -0.204020462& -0.20732998 \\
-1.75941910& -0.3826535& -0.86317511& -1.17272788& -0.865691407&  0.12542483 \\
-1.95192515& -2.1096857&  1.13135115&  0.91256447& -0.033529896&  0.19059358 \\
-0.24144158& -3.3571269&  0.21738043&  1.42840546& -0.256638938& -0.32533218 \\
1.98337243& -0.7162408& -0.17289755& -0.37637158&  0.202418839& -0.25420678 \\
0.73442430& -0.7828704& -0.07627906& -0.46668505&  1.061208739& -0.52216426 \\
0.53228046& -0.6705084&  0.04502957& -0.41734440&  1.233682980& -0.25313938 \\
-0.37260533& -0.5712985&  1.32752250& -0.83881402&  0.043950908&  0.54991653 \\
0.34063969& -0.2236844&  0.59420850& -0.93477773& -0.009209529&  0.85547004 \\
-0.25306113&  0.1018299&  1.54180034& -0.54482210& -0.818951578& -0.47394187 \\
1.13138487&  0.1457486&  0.74310059& -0.28906437&  0.448604684&  0.38436376 \\
0.26399863& -1.2144046& -0.14020651& -0.12147196& -0.240048044& -0.04377519 \\
-1.30421117&  2.4709380&  0.21944271&  0.01303094 & 0.504568106& -0.33221632 \\
-1.21980212&  1.6156676&  0.38826932&  0.71976837& -0.148517945& -0.21359085 \\
-0.07690509&  1.8051120&  0.27156821&  1.24900452&  0.206211966&  0.49705097 \\
-0.35915931&  1.2125308& -1.25387195&  0.04770938&  0.035716022&  0.03874664 \\
-1.27762217&  2.1233680&  0.88368884& -0.07337295& -0.293427995& -0.50109002 \\
\end{array}
\right)\] 

\section{ACP datos faltantes}
\subsection{NIPALS}
~\\El algoritmo NIPALS realiza una descomposición singular de una matriz de datos, mediante secuencias iterativas convergentes de proyecciones ortogonales, el cuál utiliza la descomposición derivada del ACP que permite realizar la reconstitución de la matriz con los datos faltantes estimados. \citeasnoun{Vic}.

~\\La siguiente figura es el esquema básico del algoritmo NIPALS
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.6]{FigurasUV/N.png}
  \caption{Esquema del algoritmo NIPALS}\label{figura1}
\end{figure}

~\\El pseudocódigo de este algoritmo propuesto por \citeasnoun{Vic}, es el siguiente:
\begin{itemize}
\item[]Etapa 1. $X_{0}=X_{h}$
\item[]Etapa 2. $h=1,2,...,a:$
\begin{itemize}
\item[]Etapa 2.1. $t_{h}=1^{\underline{a}}$ columna de $X_{h-1}$
\item[]Etapa 2.2. :Repetir hasta la convergencia de $P_{h}$
\begin{itemize}
\item[]Etapa 2.2.1 Para $j=1,2,...,p:$
\begin{center}
$P_{hj}=\frac{\sum_{\{i:x_{ji}  \;e   \;t_{hi} \;existen \}}x_{h-1,ji^{t}hi}}{\{i:x_{ji}  \;e   \;t_{hi} \;existen \}t^{2}_{hi}}$          \;\;\;\;\;\;\;\;\;$[cov(t_h,x_{h-1,j})/s^2_{th}]$
\end{center}
\item[]Etapa 2.2.2 normar $P_{h}$ a 1.
\item[]Etapa 2.2.3 Para $i=1,2,...,n:$       \;\;\;\;\;\;  $t_{hi}=\frac{\sum_{\{j:x_{ji} \;existe \}}x_{h-1,ji^{P}hj}}{\sum_{\{j:x_{ji}  \;existe \}P^{2}_{hj}}}$
\end{itemize}
\item[]Etapa 2.3. $X_h=X_{h-1}-t_{h}P'_{h}$
\end{itemize}
\item[]Fin
\end{itemize}

~\\Para realizar este algoritmo NIPALS en matrices con datos faltantes, generamos NA's de forma aleatoria (se generaron pares de números correspondientes a las filas y columnas de la matriz y se reemplazaron por NA) en la matriz de datos correspondiente a la base de datos dada en la introducción , con 5,10,15, y 20\% de NA's o datos faltantes. Esas matrices son las siguientes:
\begin{itemize}
\item Matrices con el 5\% y 10\% de datos faltantes respectivamente:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/5y10.png}
\end{figure}
\pagebreak
\item Matrices con el 15\% y 20\% de datos faltantes respectivamente:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/15y20.png}
\end{figure}
\end{itemize}
\subsection{Resultados}
~\\Los valores propios obtenidos mediante el algoritmo NIPALS para las matrices con 5,10,15 y 20\% son:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/vlpnipals.png}
\end{figure}
~\\En cuanto a los vectores propios obtenidos, por cuestiones de espacio, compararemos solo los tres primeros vectores propios de cada matriz:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/vtpnipals.png}
\end{figure}
\pagebreak
~\\Las componentes principales, también mostraremos las primeras tres para cada matriz:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/cpnipals.png}
\end{figure}

\subsection{EM-PCA}
~\\El método Análisis de Componentes Principales vía EM (ACP-EM), es un método propuesto por Josse and Husson (2012), él cual realiza un Análisis de Componentes principales en presencia de datos faltantes. Particularmente, los datos faltantes son estimados inicialmente por valores promedio y luego se desea minimizar la distancia entre los valores originales (Z) y los valores estimados ($\varPsi u'$). \citeasnoun{Ochoa}

~\\Para realizar este algoritmo en \citeasnoun{R}, usamos la función del paquete ade4. El pseudocódigo de este algoritmo propuesto por \citeasnoun{Ochoa} es:
\begin{itemize}
\item[1.]Iniciación L=0

$Z^0$ los datos faltantes son reemplazados por valores iniciales, como por ejemplo la media.
\item[2.]Paso L
\item[2.1]Realice un ACP para calcular $\varPsi^L$,$u^L$, tomando q dimensiones (para garantizar un proceso iterativo).
\item[2.2]Los valores faltantes son imputados via reconstitución de la matriz $Z^L=\varPsi^L u'^L$.
Los valores observados son los mismos y los faltantes se reemplazan por la imputación.
\item[3.]Se repiten el paso 2.1 y 2.2 hasta la convergencia.
\end{itemize}

\subsection{Resultados}
~\\Los valores propios obtenidos mediante el algoritmo EM-PCA para las matrices con 5,10,15 y 20\% de datos faltantes son:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/vlpacpem.png}
\end{figure}
~\\En cuanto a los vectores propios obtenidos, por cuestiones de espacio, compararemos solo los tres primeros vectores propios de cada matriz:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/vtpacpem.png}
\end{figure}

~\\Las componentes principales, también mostraremos las primeras tres para cada matriz:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/cpacpem.png}
\end{figure}

\section{Comparaciones}
\begin{itemize}
\item[1.]Poder descriptivo en los dos primeros ejes
~\\El poder descriptivo de las dos primeras componentes para los tres métodos y las matrices generadas con el 5,10,15 y 20\% de datos faltantes se resume en la siguiente tabla:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.5]{FigurasUV/podesc.png}
\end{figure}
\pagebreak
\item[2.]Valores propios
~\\La comparación de los valores propios se puede ver en la siguiente tabla:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.7]{FigurasUV/compvlp.png}
\end{figure}
\item[3.]Vectores propios
~\\La comparación de los dos primeros vectores propios se puede ver en la siguiente tabla:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.63]{FigurasUV/compvtp.png}
\end{figure}
\item[4.]Componentes principales
~\\La comparación de las dos primeras componentes principales se puede ver en la siguiente tabla:
\begin{figure}[h]
  \centering
  \includegraphics[scale=0.63]{FigurasUV/compcomp.png}
\end{figure}
\pagebreak
\item[5.]Correlación entre la componente 1 completo y faltantes
~\\Para comparar estas correlaciones, se obtendrá el valor absoluto de la correlación entre la componente 1 de la matriz completa y la componente 1 de cada una de las matrices incompletas por NIPLALS y por ACP-EM. Se sacará el valor absoluto ya que por cuestiones del código, los signos entre una componente y otra pueden ser iguales o inversos.
\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.8]{FigurasUV/compcor.png}
\end{figure}
\item[6.]Estructura factorial en la nube de individuos
~\\Para comparar estas estructuras, solo se comparara el ACP con datos completos con el ACP-EM y el NIPALs para la matriz con más datos faltantes (20\% de datos faltantes)
~\\La nube de individuos correspondiente al ACP de la matriz de datos completos es
\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.38]{FigurasUV/nubeindcom.pdf}
\end{figure}

~\\Las nubes de individuos para el NIPALS y el ACP-EM con una matriz del 20\% de datos faltantes es respectivamente
\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.42]{FigurasUV/nubeindna.pdf}
\end{figure}
\pagebreak
\item[7.]Estructura factorial en la nube de variables
~\\Para comparar estas estructuras, solo se comparara el ACP con datos completos con el ACP-EM y el NIPALs para la matriz con más datos faltantes (20\% de datos faltantes)

~\\La nube de variables correspondiente al ACP de la matriz de datos completos es
\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.45]{FigurasUV/nubevarcom.pdf}
\end{figure}

~\\Las nubes de variables para el NIPALS y el ACP-EM con una matriz del 20\% de datos faltantes es respectivamente
\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.45]{FigurasUV/nubevarna.pdf}
\end{figure}

\pagebreak
\item[8.]Ortogonalidad en las dos primeras componentes y ortonormalidad en los dos primeros vectores propios
~\\La ortogonalidad en las dos primeras componentes se puede evidenciar en la siguiente tabla, donde se hizo el producto punto entre la componente 1 y la componente 2
\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.8]{FigurasUV/ortocom.png}
\end{figure}

~\\La ortonormalidad en los dos primeros vectores propios se puede ver en la siguiente tabla, donde se obtuvo la norma de cada uno, y posteriormente se hizo su producto punto.
\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.8]{FigurasUV/ortovec.png}
\end{figure}

\item[9.]Imputación


\end{itemize}





\setlength{\parskip}{1mm}
\pagebreak
~\\\nocite{REX}
\nocite{ggp2}
\nocite{FE}
\nocite{FMR}
\nocite{Multi}
\nocite{Leb}

% //// --------------------------------------------------------------------------------
% -------------------------------------------------------------------------------------
% Fin del cuerpo del documento
% **** --------------------------------------------------------------------------------
% **** --------------------------------------------------------------------------------
% Espacio para colocar el nombre del archivo *.bib (sin la extensión .bib) que contiene
% las referencias bibliográficas del artículo utilizando el estilo bibliográfico BibTeX
% "\referencias{.}"
% **** --------------------------------------------------------------------------------
\bibliography{references}
% //// --------------------------------------------------------------------------------
% //// --------------------------------------------------------------------------------
    \appendix% !no modificar esta línea¡
% -------------------------------------------------------------------------------------
% Espacio para ubicar los apéndices: tablas y gráficas
% **** --------------------------------------------------------------------------------


% -------------------------------------------------------------------------------------
% Fin del artículo
% **** --------------------------------------------------------------------------------
\end{document}
